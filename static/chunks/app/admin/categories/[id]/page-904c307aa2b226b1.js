(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[375],{3473:function(e,t,a){Promise.resolve().then(a.bind(a,9670))},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},9670:function(e,t,a){"use strict";a.r(t);var s=a(7437),n=a(2265),c=a(9376),r=a(1268),i=a(5217),l=a(3335),o=a(7648);t.default=()=>{let[e,t]=(0,n.useState)(!1),[a,d]=(0,n.useState)(!1),[m,u]=(0,n.useState)(null),[x,h]=(0,n.useState)(""),[f,p]=(0,n.useState)(""),[b,j]=(0,n.useState)(void 0),{id:g}=(0,c.useParams)(),v=(0,c.useRouter)(),[y,N]=(0,n.useState)(null),w=async()=>{try{t(!0);let e=await fetch("/api/categories",{method:"GET",cache:"no-store"});if(!e.ok)throw N(null),Error("カテゴリの一覧のフェッチに失敗しました: (".concat(e.status,": ").concat(e.statusText,")"));let a=await e.json();N(a.map(e=>({id:e.id,name:e.name})))}catch(t){let e=t instanceof Error?t.message:"予期せぬエラーが発生しました ".concat(t);console.error(e),u(e)}finally{t(!1)}};(0,n.useEffect)(()=>{w()},[]),(0,n.useEffect)(()=>{let e=null==y?void 0:y.find(e=>e.id===g);void 0!==e&&j(e.name)},[y,g]);let E=e=>e.length<2||e.length>16?"2文字以上16文字以内で入力してください。":y&&y.some(t=>t.name===e)?"同じ名前のカテゴリが既に存在します。":"",k=async e=>{e.preventDefault(),d(!0);try{let e="/api/admin/categories/".concat(g),t=await fetch(e,{method:"PUT",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:x})});if(!t.ok)throw Error("".concat(t.status,": ").concat(t.statusText));h(""),await w()}catch(t){let e=t instanceof Error?"カテゴリのPUTリクエストに失敗しました\n".concat(t.message):"予期せぬエラーが発生しました\n".concat(t);console.error(e),window.alert(e)}finally{d(!1)}},S=async()=>{if(window.confirm("カテゴリ「".concat(b,"」を本当に削除しますか？"))){d(!0);try{let e="/api/admin/categories/".concat(g),t=await fetch(e,{method:"DELETE",cache:"no-store"});if(!t.ok)throw Error("".concat(t.status,": ").concat(t.statusText));v.replace("/admin/categories")}catch(t){let e=t instanceof Error?"カテゴリのDELETEリクエストに失敗しました\n".concat(t.message):"予期せぬエラーが発生しました\n".concat(t);console.error(e),window.alert(e),d(!1)}}};return e?(0,s.jsxs)("div",{className:"text-gray-500",children:[(0,s.jsx)(r.G,{icon:i.LM3,className:"mr-1 animate-spin"}),"Loading..."]}):y?void 0===b?(0,s.jsx)("div",{className:"text-red-500",children:"指定された id のカテゴリは存在しません。"}):(0,s.jsxs)("main",{children:[(0,s.jsx)("div",{className:"mb-4 text-2xl font-bold",children:"カテゴリの編集・削除"}),(0,s.jsxs)("form",{onSubmit:k,className:(0,l.m6)("mb-4 space-y-4",a&&"opacity-50"),children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"block font-bold",children:"現在のカテゴリの名前"}),(0,s.jsx)("div",{className:"text-gray-500",children:b})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"name",className:"block font-bold",children:"新しいカテゴリの名前"}),(0,s.jsx)("input",{type:"text",id:"name",name:"name",className:"w-full rounded-md border-2 px-2 py-1",placeholder:"新しいカテゴリの名前を記入してください",value:x,onChange:e=>{p(E(e.target.value)),h(e.target.value)},autoComplete:"off",required:!0}),f&&(0,s.jsxs)("div",{className:"flex items-center space-x-1 text-sm font-bold text-red-500",children:[(0,s.jsx)(r.G,{icon:i.ik8,className:"mr-0.5"}),(0,s.jsx)("div",{children:f})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{type:"submit",className:(0,l.m6)("rounded-md px-5 py-1 font-bold","bg-indigo-500 text-white hover:bg-indigo-600","disabled:cursor-not-allowed disabled:opacity-50"),disabled:a||""!==f||""===x,children:"カテゴリの名前を変更"}),(0,s.jsx)("button",{type:"button",className:(0,l.m6)("rounded-md px-5 py-1 font-bold","bg-red-500 text-white hover:bg-red-600"),onClick:S,children:"削除"})]})]}),(0,s.jsx)("div",{className:"mb-2 text-2xl font-bold",children:"既存のカテゴリの一覧"}),0===y.length?(0,s.jsx)("div",{className:"text-gray-500",children:"（カテゴリは1個も作成されていません）"}):(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-2",children:"クリックすると各カテゴリの名前編集・削除画面に移動します。"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:y.map(e=>(0,s.jsx)("div",{className:(0,l.m6)("rounded-md px-2 py-0.5","border border-slate-400 text-slate-500",b===e.name&&" bg-gray-100"),children:(0,s.jsx)(o.default,{href:"/admin/categories/".concat(e.id),children:e.name})},e.id))})]}),a&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,s.jsxs)("div",{className:"flex items-center rounded-lg bg-white px-8 py-4 shadow-lg",children:[(0,s.jsx)(r.G,{icon:i.LM3,className:"mr-2 animate-spin text-gray-500"}),(0,s.jsx)("div",{className:"flex items-center text-gray-500",children:"処理中..."})]})})]}):(0,s.jsx)("div",{className:"text-red-500",children:m})}}},function(e){e.O(0,[676,268,335,648,971,117,744],function(){return e(e.s=3473)}),_N_E=e.O()}]);
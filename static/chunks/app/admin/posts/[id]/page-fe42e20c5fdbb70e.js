(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{1988:function(e,t,s){Promise.resolve().then(s.bind(s,8635))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},8635:function(e,t,s){"use strict";s.r(t);var a=s(7437),c=s(2265),n=s(9376),l=s(1268),r=s(5217),o=s(3335);t.default=()=>{let[e,t]=(0,c.useState)(!1),[s,i]=(0,c.useState)(!1),[d,u]=(0,c.useState)(null),[m,h]=(0,c.useState)(""),[x,p]=(0,c.useState)(""),[f,g]=(0,c.useState)(""),{id:b}=(0,n.useParams)(),j=(0,n.useRouter)(),[y,N]=(0,c.useState)(null),[v,w]=(0,c.useState)(null);(0,c.useEffect)(()=>{(async()=>{try{let e="/api/posts/".concat(b),t=await fetch(e,{method:"GET",cache:"no-store"});if(!t.ok)throw w(null),Error("".concat(t.status,": ").concat(t.statusText));let s=await t.json();w(s)}catch(t){let e=t instanceof Error?"投稿記事の取得に失敗しました: ".concat(t.message):"予期せぬエラーが発生しました ".concat(t);console.error(e),u(e)}})()},[b]),(0,c.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/categories",{method:"GET",cache:"no-store"});if(!e.ok)throw N(null),Error("".concat(e.status,": ").concat(e.statusText));let t=await e.json();N(t.map(e=>({id:e.id,name:e.name,isSelect:!1})))}catch(t){let e=t instanceof Error?"カテゴリの一覧のフェッチに失敗しました: ".concat(t.message):"予期せぬエラーが発生しました ".concat(t);console.error(e),u(e)}})()},[]),(0,c.useEffect)(()=>{if(e||!v||!y)return;h(v.title),p(v.content),g(v.coverImageURL);let s=new Set(v.categories.map(e=>e.category.id));N(y.map(e=>({...e,isSelect:s.has(e.id)}))),t(!0)},[e,v,y]);let S=e=>{y&&N(y.map(t=>t.id===e?{...t,isSelect:!t.isSelect}:t))},E=async e=>{e.preventDefault(),i(!0);try{let e={title:m,content:x,coverImageURL:f,categoryIds:y?y.filter(e=>e.isSelect).map(e=>e.id):[]},t="/api/admin/posts/".concat(b);console.log("".concat(t," => ").concat(JSON.stringify(e,null,2)));let s=await fetch(t,{method:"PUT",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw Error("".concat(s.status,": ").concat(s.statusText));i(!1),j.push("/")}catch(t){let e=t instanceof Error?"投稿記事のPOSTリクエストに失敗しました\n".concat(t.message):"予期せぬエラーが発生しました\n".concat(t);console.error(e),window.alert(e),i(!1)}};return d?(0,a.jsx)("div",{className:"text-red-500",children:d}):e?(0,a.jsxs)("main",{children:[(0,a.jsx)("div",{className:"mb-4 text-2xl font-bold",children:"投稿記事の編集・削除"}),s&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"flex items-center rounded-lg bg-white px-8 py-4 shadow-lg",children:[(0,a.jsx)(l.G,{icon:r.LM3,className:"mr-2 animate-spin text-gray-500"}),(0,a.jsx)("div",{className:"flex items-center text-gray-500",children:"処理中..."})]})}),(0,a.jsxs)("form",{onSubmit:E,className:(0,o.m6)("space-y-4",s&&"opacity-50"),children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{htmlFor:"title",className:"block font-bold",children:"タイトル"}),(0,a.jsx)("input",{type:"text",id:"title",name:"title",className:"w-full rounded-md border-2 px-2 py-1",value:m,onChange:e=>{h(e.target.value)},placeholder:"タイトルを記入してください",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{htmlFor:"content",className:"block font-bold",children:"本文"}),(0,a.jsx)("textarea",{id:"content",name:"content",className:"h-48 w-full rounded-md border-2 px-2 py-1",value:x,onChange:e=>{p(e.target.value)},placeholder:"本文を記入してください",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{htmlFor:"coverImageURL",className:"block font-bold",children:"カバーイメージ (URL)"}),(0,a.jsx)("input",{type:"url",id:"coverImageURL",name:"coverImageURL",className:"w-full rounded-md border-2 px-2 py-1",value:f,onChange:e=>{g(e.target.value)},placeholder:"カバーイメージのURLを記入してください",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"font-bold",children:"タグ"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-x-3.5",children:y.length>0?y.map(e=>(0,a.jsxs)("label",{className:"flex space-x-1",children:[(0,a.jsx)("input",{id:e.id,type:"checkbox",checked:e.isSelect,className:"mt-0.5 cursor-pointer",onChange:()=>S(e.id)}),(0,a.jsx)("span",{className:"cursor-pointer",children:e.name})]},e.id)):(0,a.jsx)("div",{children:"選択可能なカテゴリが存在しません。"})})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)("button",{type:"submit",className:(0,o.m6)("rounded-md px-5 py-1 font-bold","bg-indigo-500 text-white hover:bg-indigo-600","disabled:cursor-not-allowed"),disabled:s,children:"記事を更新"}),(0,a.jsx)("button",{type:"button",className:(0,o.m6)("rounded-md px-5 py-1 font-bold","bg-red-500 text-white hover:bg-red-600"),children:"削除"})]})]})]}):(0,a.jsxs)("div",{className:"text-gray-500",children:[(0,a.jsx)(l.G,{icon:r.LM3,className:"mr-1 animate-spin"}),"Loading..."]})}}},function(e){e.O(0,[676,268,335,971,117,744],function(){return e(e.s=1988)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[629],{6991:function(e,t,s){Promise.resolve().then(s.bind(s,442))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},442:function(e,t,s){"use strict";s.r(t);var a=s(7437),l=s(2265),n=s(9376),c=s(1268),r=s(5217),i=s(3335);t.default=()=>{let[e,t]=(0,l.useState)(!1),[s,o]=(0,l.useState)(!1),[d,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(""),[x,p]=(0,l.useState)(""),[f,j]=(0,l.useState)(""),b=(0,n.useRouter)(),[g,N]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{t(!0);let e=await fetch("/api/categories",{method:"GET",cache:"no-store"});if(!e.ok)throw N(null),Error("".concat(e.status,": ").concat(e.statusText));let s=await e.json();N(s.map(e=>({id:e.id,name:e.name,isSelect:!1})))}catch(t){let e=t instanceof Error?"カテゴリの一覧のフェッチに失敗しました: ".concat(t.message):"予期せぬエラーが発生しました ".concat(t);console.error(e),u(e)}finally{t(!1)}})()},[]);let y=e=>{g&&N(g.map(t=>t.id===e?{...t,isSelect:!t.isSelect}:t))},v=async e=>{e.preventDefault(),o(!0);try{let e={title:m,content:x,coverImageURL:f,categoryIds:g?g.filter(e=>e.isSelect).map(e=>e.id):[]},t="/api/admin/posts";console.log("".concat(t," => ").concat(JSON.stringify(e,null,2)));let s=await fetch(t,{method:"POST",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw Error("".concat(s.status,": ").concat(s.statusText));let a=await s.json();o(!1),b.push("/posts/".concat(a.id))}catch(t){let e=t instanceof Error?"投稿記事のPOSTリクエストに失敗しました\n".concat(t.message):"予期せぬエラーが発生しました\n".concat(t);console.error(e),window.alert(e),o(!1)}};return e?(0,a.jsxs)("div",{className:"text-gray-500",children:[(0,a.jsx)(c.G,{icon:r.LM3,className:"mr-1 animate-spin"}),"Loading..."]}):g?(0,a.jsxs)("main",{children:[(0,a.jsx)("div",{className:"mb-4 text-2xl font-bold",children:"投稿記事の新規作成"}),s&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"flex items-center rounded-lg bg-white px-8 py-4 shadow-lg",children:[(0,a.jsx)(c.G,{icon:r.LM3,className:"mr-2 animate-spin text-gray-500"}),(0,a.jsx)("div",{className:"flex items-center text-gray-500",children:"処理中..."})]})}),(0,a.jsxs)("form",{onSubmit:v,className:(0,i.m6)("space-y-4",s&&"opacity-50"),children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{htmlFor:"title",className:"block font-bold",children:"タイトル"}),(0,a.jsx)("input",{type:"text",id:"title",name:"title",className:"w-full rounded-md border-2 px-2 py-1",value:m,onChange:e=>{h(e.target.value)},placeholder:"タイトルを記入してください",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{htmlFor:"content",className:"block font-bold",children:"本文"}),(0,a.jsx)("textarea",{id:"content",name:"content",className:"h-48 w-full rounded-md border-2 px-2 py-1",value:x,onChange:e=>{p(e.target.value)},placeholder:"本文を記入してください",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{htmlFor:"coverImageURL",className:"block font-bold",children:"カバーイメージ (URL)"}),(0,a.jsx)("input",{type:"url",id:"coverImageURL",name:"coverImageURL",className:"w-full rounded-md border-2 px-2 py-1",value:f,onChange:e=>{j(e.target.value)},placeholder:"カバーイメージのURLを記入してください",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"font-bold",children:"タグ"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-x-3.5",children:g.length>0?g.map(e=>(0,a.jsxs)("label",{className:"flex space-x-1",children:[(0,a.jsx)("input",{id:e.id,type:"checkbox",checked:e.isSelect,className:"mt-0.5 cursor-pointer",onChange:()=>y(e.id)}),(0,a.jsx)("span",{className:"cursor-pointer",children:e.name})]},e.id)):(0,a.jsx)("div",{children:"選択可能なカテゴリが存在しません。"})})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{type:"submit",className:(0,i.m6)("rounded-md px-5 py-1 font-bold","bg-indigo-500 text-white hover:bg-indigo-600","disabled:cursor-not-allowed"),disabled:s,children:"記事を投稿"})})]})]}):(0,a.jsx)("div",{className:"text-red-500",children:d})}}},function(e){e.O(0,[676,268,335,971,117,744],function(){return e(e.s=6991)}),_N_E=e.O()}]);